<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<title>OCR Drift Dashboard</title>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<style>
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:24px}
h1{margin:0 0 8px}
.small{color:#666;font-size:12px}
table{border-collapse:collapse;width:100%;margin-top:12px}
th,td{border:1px solid #e5e7eb;padding:8px;text-align:left}
th{background:#f8fafc}
.badge{display:inline-block;padding:2px 8px;border-radius:999px;font-size:12px;border:1px solid #e5e7eb}
.ok{background:#ecfdf5}
.warn{background:#fff7ed}
.fail{background:#fef2f2}
.spark{display:inline-block;height:24px;width:120px;vertical-align:middle}
footer{margin-top:24px;color:#666;font-size:12px}
</style>
</head>
<body>
<h1>OCR Drift Dashboard</h1>
<div class="small">Generated 2025-10-05T12:30:35.297Z</div>


<table>
  <thead>
    <tr>
      <th>Field</th><th>Prev</th><th>Last</th><th>Δ</th><th>Support</th><th>Trend</th>
    </tr>
  </thead>
  <tbody>
    
  </tbody>
</table>

<footer>Δ classes: ok ≥ 0 · warn &lt; 0 · fail ≤ -2 (global threshold)</footer>

<script>
(async function(){
  const histUrl = null;
  const trends = {};
  if(histUrl){
    try{
      const md = await fetch(histUrl).then(r=>r.text());
      const lines = md.split(/\r?\n/);
      // naive parse: lines like "field_x: 88,89,90"
      for(const ln of lines){
        const m = ln.match(/^\s*([\w.-]+)\s*:\s*([0-9.,\s-]+)$/);
        if(m){ trends[m[1]] = m[2].split(/,\s*/).map(Number).filter(n=>Number.isFinite(n)).slice(-20); }
      }
    } catch {}
  }
  document.querySelectorAll("canvas.spark").forEach(cv=>{
    const f = cv.dataset.field;
    const series = trends[f] || [];
    const ctx = cv.getContext("2d");
    const w = cv.width = cv.clientWidth;
    const h = cv.height = cv.clientHeight;
    if(!series.length){ ctx.fillStyle="#e5e7eb"; ctx.fillRect(0,h-2,w,2); return; }
    const min = Math.min(...series), max = Math.max(...series);
    const nx = series.length-1 || 1;
    ctx.beginPath();
    series.forEach((v,i)=>{
      const x = i* (w/nx);
      const y = h - ( (v - min) / (max - min || 1) ) * (h-4) - 2;
      if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
    });
    ctx.lineWidth = 2;
    ctx.strokeStyle = "#111827";
    ctx.stroke();
  });
})();
</script>
</body>
</html>